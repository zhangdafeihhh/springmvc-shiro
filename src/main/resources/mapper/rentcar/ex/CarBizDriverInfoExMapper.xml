<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mapper.rentcar.ex.CarBizDriverInfoExMapper" >
  <resultMap id="BaseResultMap" type="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO" >
    <id column="driver_id" property="driverId" jdbcType="INTEGER" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="supplier_id" property="supplierId" jdbcType="INTEGER" />
    <result column="age" property="age" jdbcType="INTEGER" />
    <result column="current_address" property="currentAddress" jdbcType="VARCHAR" />
    <result column="emergency_contact_person" property="emergencyContactPerson" jdbcType="VARCHAR" />
    <result column="emergency_contact_number" property="emergencyContactNumber" jdbcType="VARCHAR" />
    <result column="id_card_no" property="idCardNo" jdbcType="VARCHAR" />
    <result column="superintend_no" property="superintendNo" jdbcType="VARCHAR" />
    <result column="superintend_url" property="superintendUrl" jdbcType="VARCHAR" />
    <result column="driving_license_type" property="drivingLicenseType" jdbcType="VARCHAR" />
    <result column="driving_years" property="drivingYears" jdbcType="INTEGER" />
    <result column="archives_no" property="archivesNo" jdbcType="VARCHAR" />
    <result column="issue_date" property="issueDate" jdbcType="TIMESTAMP" />
    <result column="expire_date" property="expireDate" jdbcType="TIMESTAMP" />
    <result column="service_city" property="serviceCity" jdbcType="INTEGER" />
    <result column="attachment_name" property="attachmentName" jdbcType="VARCHAR" />
    <result column="attachment_addr" property="attachmentAddr" jdbcType="VARCHAR" />
    <result column="account_bank" property="accountBank" jdbcType="VARCHAR" />
    <result column="bank_account_no" property="bankAccountNo" jdbcType="VARCHAR" />
    <result column="license_plates" property="licensePlates" jdbcType="VARCHAR" />
    <result column="update_date" property="updateDate" jdbcType="TIMESTAMP" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="update_by" property="updateBy" jdbcType="INTEGER" />
    <result column="create_by" property="createBy" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="mac" property="mac" jdbcType="VARCHAR" />
    <result column="photoSrct" property="photosrct" jdbcType="VARCHAR" />
    <result column="push_id" property="pushId" jdbcType="VARCHAR" />
    <result column="is_binding_credit_card" property="isBindingCreditCard" jdbcType="INTEGER" />
    <result column="app_version" property="appVersion" jdbcType="VARCHAR" />
    <result column="credit_card_no" property="creditCardNo" jdbcType="VARCHAR" />
    <result column="storable_card_no" property="storableCardNo" jdbcType="VARCHAR" />
    <result column="credit_open_account_bank" property="creditOpenAccountBank" jdbcType="VARCHAR" />
    <result column="credit_card_period_of_validity" property="creditCardPeriodOfValidity" jdbcType="VARCHAR" />
    <result column="grab_notice" property="grabNotice" jdbcType="INTEGER" />
    <result column="credit_CVN2" property="creditCvn2" jdbcType="VARCHAR" />
    <result column="credit_bind_date" property="creditBindDate" jdbcType="TIMESTAMP" />
    <result column="quickpay_customerid" property="quickpayCustomerid" jdbcType="VARCHAR" />
    <result column="is_read" property="isRead" jdbcType="INTEGER" />
    <result column="bankid" property="bankid" jdbcType="VARCHAR" />
    <result column="go_home_address" property="goHomeAddress" jdbcType="VARCHAR" />
    <result column="go_home_point_loBD" property="goHomePointLobd" jdbcType="VARCHAR" />
    <result column="go_home_point_laBD" property="goHomePointLabd" jdbcType="VARCHAR" />
    <result column="go_home_point_la" property="goHomePointLa" jdbcType="VARCHAR" />
    <result column="go_home_point_lo" property="goHomePointLo" jdbcType="VARCHAR" />
    <result column="go_home_status" property="goHomeStatus" jdbcType="INTEGER" />
    <result column="update_go_home_date" property="updateGoHomeDate" jdbcType="VARCHAR" />
    <result column="imei" property="imei" jdbcType="VARCHAR" />
    <result column="driverLicenseNumber" property="driverlicensenumber" jdbcType="VARCHAR" />
    <result column="drivingLicenseImg" property="drivinglicenseimg" jdbcType="VARCHAR" />
    <result column="firstDrivingLicenseDate" property="firstdrivinglicensedate" jdbcType="VARCHAR" />
    <result column="firstMeshworkDrivingLicenseDate" property="firstmeshworkdrivinglicensedate" jdbcType="VARCHAR" />
    <result column="nationality" property="nationality" jdbcType="VARCHAR" />
    <result column="householdRegister" property="householdregister" jdbcType="VARCHAR" />
    <result column="nation" property="nation" jdbcType="VARCHAR" />
    <result column="marriage" property="marriage" jdbcType="VARCHAR" />
    <result column="foreignLanguage" property="foreignlanguage" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="education" property="education" jdbcType="VARCHAR" />
    <result column="courseName" property="coursename" jdbcType="VARCHAR" />
    <result column="courseDate" property="coursedate" jdbcType="VARCHAR" />
    <result column="courseDateStart" property="coursedatestart" jdbcType="VARCHAR" />
    <result column="courseDateEnd" property="coursedateend" jdbcType="VARCHAR" />
    <result column="courseTime" property="coursetime" jdbcType="VARCHAR" />
    <result column="corpType" property="corptype" jdbcType="VARCHAR" />
    <result column="trafficViolations" property="trafficviolations" jdbcType="VARCHAR" />
    <result column="signDate" property="signdate" jdbcType="VARCHAR" />
    <result column="signDateEnd" property="signdateend" jdbcType="VARCHAR" />
    <result column="contractDate" property="contractdate" jdbcType="VARCHAR" />
    <result column="isXyDriver" property="isxydriver" jdbcType="INTEGER" />
    <result column="partTimeJobDri" property="parttimejobdri" jdbcType="VARCHAR" />
    <result column="phoneType" property="phonetype" jdbcType="VARCHAR" />
    <result column="phoneCorp" property="phonecorp" jdbcType="VARCHAR" />
    <result column="appVersion" property="appversion" jdbcType="VARCHAR" />
    <result column="mapType" property="maptype" jdbcType="VARCHAR" />
    <result column="emergencyContactAddr" property="emergencycontactaddr" jdbcType="VARCHAR" />
    <result column="assessment" property="assessment" jdbcType="VARCHAR" />
    <result column="driverLicenseIssuingDateStart" property="driverlicenseissuingdatestart" jdbcType="VARCHAR" />
    <result column="driverLicenseIssuingDateEnd" property="driverlicenseissuingdateend" jdbcType="VARCHAR" />
    <result column="driverLicenseIssuingCorp" property="driverlicenseissuingcorp" jdbcType="VARCHAR" />
    <result column="driverLicenseIssuingNumber" property="driverlicenseissuingnumber" jdbcType="VARCHAR" />
    <result column="xy_driver_number" property="xyDriverNumber" jdbcType="VARCHAR" />
    <result column="driver_license_issuing_register_date" property="driverLicenseIssuingRegisterDate" jdbcType="VARCHAR" />
    <result column="driver_license_issuing_first_date" property="driverLicenseIssuingFirstDate" jdbcType="VARCHAR" />
    <result column="driver_license_issuing_grant_date" property="driverLicenseIssuingGrantDate" jdbcType="VARCHAR" />
    <result column="birth_day" property="birthDay" jdbcType="VARCHAR" />
    <result column="house_hold_register_permanent" property="houseHoldRegisterPermanent" jdbcType="VARCHAR" />
    <result column="is_upload_card" property="isUploadCard" jdbcType="INTEGER" />
    <result column="is_must_confirmation" property="isMustConfirmation" jdbcType="INTEGER" />
    <result column="contract_type" property="contractType" jdbcType="VARCHAR" />
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
    <result column="contract_file" property="contractFile" jdbcType="VARCHAR" />
    <result column="cooperation_type" property="cooperationType" jdbcType="TINYINT" />
    <result column="account_type" property="accountType" jdbcType="INTEGER" />
    <result column="group_id" property="groupId" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO" extends="BaseResultMap" >
    <result column="contract_type" property="contractType" jdbcType="VARCHAR" />
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
    <result column="contract_file" property="contractFile" jdbcType="VARCHAR" />
    <result column="cooperation_type" property="cooperationType" jdbcType="INTEGER" />
    <result column="account_type" property="accountType" jdbcType="INTEGER" />
    <result column="group_id" property="groupId" jdbcType="INTEGER" />
    <result column="is_two_shifts" property="isTwoShifts" jdbcType="INTEGER" />
    <result column="is_image" property="isImage" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    driver_id, password, phone, gender, name, supplier_id, age, current_address, emergency_contact_person, 
    emergency_contact_number, id_card_no, superintend_no, superintend_url, driving_license_type, 
    driving_years, archives_no, issue_date, expire_date, service_city, attachment_name, 
    attachment_addr, account_bank, bank_account_no, license_plates, update_date, create_date, 
    update_by, create_by, status, mac, photoSrct, push_id, is_binding_credit_card, app_version, 
    credit_card_no, storable_card_no, credit_open_account_bank, credit_card_period_of_validity, 
    grab_notice, credit_CVN2, credit_bind_date, quickpay_customerid, is_read, bankid, 
    go_home_address, go_home_point_loBD, go_home_point_laBD, go_home_point_la, go_home_point_lo, 
    go_home_status, update_go_home_date, imei, driverLicenseNumber, drivingLicenseImg, 
    firstDrivingLicenseDate, firstMeshworkDrivingLicenseDate, nationality, householdRegister, 
    nation, marriage, foreignLanguage, address, education, courseName, courseDate, courseDateStart, 
    courseDateEnd, courseTime, corpType, trafficViolations, signDate, signDateEnd, contractDate, 
    isXyDriver, partTimeJobDri, phoneType, phoneCorp, appVersion, mapType, emergencyContactAddr, 
    assessment, driverLicenseIssuingDateStart, driverLicenseIssuingDateEnd, driverLicenseIssuingCorp, 
    driverLicenseIssuingNumber, xy_driver_number, driver_license_issuing_register_date, 
    driver_license_issuing_first_date, driver_license_issuing_grant_date, birth_day, 
    house_hold_register_permanent, is_upload_card, is_must_confirmation,
    contract_type, contract_no, contract_file, cooperation_type, account_type, group_id,
    is_two_shifts, is_image,
    house_hold_register_permanent, is_upload_card, is_must_confirmation,
    contract_type, contract_no, contract_file, cooperation_type, account_type, group_id
  </sql>
  <sql id="Blob_Column_List" >
    memo
  </sql>

  <!--查询司机部分信息（只供更改车队是调用）-->
  <select id="selectDriverInfoByDriverId" parameterType="java.lang.Integer" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id AS driverId,
    i.phone AS phone,
    i.NAME AS name,
    i.license_plates AS licensePlates,
    i.cooperation_type AS cooperationType,
    i.group_id AS groupId,
    g.group_name AS carGroupName,
    i.service_city as serviceCityId,
    c.city_name AS cityName,
    i.supplier_id AS supplierId,
    p.supplier_full_name AS supplierName,
    i.STATUS AS status,
    i.update_by AS updateBy,
    DATE_FORMAT(i.create_date,'%Y-%m-%d %H:%i:%s') AS createDate
    FROM car_biz_driver_info i
    LEFT JOIN car_biz_city c ON c.city_id = i.service_city
    LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
    LEFT JOIN car_biz_car_group g ON i.group_id = g.group_id
    where i.driver_id= #{driverId}
  </select>

  <select id="queryDriverListForMonthDuty" parameterType="com.zhuanche.request.DriverMonthDutyRequest" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id AS driverId,
    i.name,
    i.license_plates AS licensePlates,
    i.status
    FROM
    car_biz_driver_info i
    LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
    where 1=1
    and i.status = 1
    <if test="cityIds!=null and cityIds.size()>0">
      and i.service_city IN
      <foreach collection="cityIds" open="(" close=")" separator="," item="cid" >
        #{cid}
      </foreach>
    </if>
    <if test="supplierIds!=null and supplierIds.size()>0">
      and p.supplier_id IN
      <foreach collection="supplierIds" open="(" close=")" separator="," item="sid" >
        #{sid}
      </foreach>
    </if>
    ORDER BY
    i.driver_id asc
  </select>

  <select id="selectDriverDetail" parameterType="string" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id as driverId,
    i.account_bank as accountBank,
    i.age as age,
    i.archives_no as archivesNo,
    i.attachment_addr as attachmentAddr,
    i.attachment_name as attachmentName,
    i.bank_account_no as bankAccountNo,
    i.create_by as createBy,
    i.create_date as createDate,
    i.credit_card_no as creditCardNo,
    i.update_by as updateBy,
    i.update_date as updateDate,
    i.credit_card_period_of_validity as creditCardPeriodOfValidity,
    i.credit_CVN2 as CVN2,
    i.credit_open_account_bank as creditOpenAccountBank,
    i.current_address as currentAddress,
    i.driving_license_type as drivingLicenseType,
    i.driving_years as drivingYears,
    i.emergency_contact_number as emergencyContactNumber,
    i.emergency_contact_person as emergencyContactPerson,
    DATE_FORMAT(i.expire_date,'%Y-%m-%d %T')as expireDate,
    i.gender as gender,
    i.id_card_no as idCardNo,
    DATE_FORMAT(i.issue_date,'%Y-%m-%d %T')as issueDate,
    i.is_binding_credit_card as isBindingCreditCard,
    i.license_plates as licensePlates,
    ci.car_id as licensePlatesId,
    i.memo as memo,
    i.`name` as name,
    i.`password` as password,
    i.phone as phone,
    i.photoSrct as photoSrc,
    i.push_id as pushId,
    i.service_city as serviceCityId,
    i.`status` as status,
    i.storable_card_no as shortCardNo,
    i.supplier_id as supplierId,
    i.superintend_no AS superintendNo,
    i.superintend_url AS superintendUrl,
    IFNULL(t.curr_account,0) as currAccount,
    IFNULL(t.hisall_account,0) as hisallAccount,
    IFNULL(t.credit_balance,0) as creditBalance,
    IFNULL(t.credit_balance_hisall,0) as creditBalanceHisall,
    IFNULL(t.out_curr_account,0) as outCurrAccount,
    IFNULL(t.out_hisall_account,0) as outHisallAccount,
    IFNULL(t.account_amount,0) as accountAmount,
    IFNULL(t.settle_account,0) as settleAccount,
    IFNULL(t.withdraw_deposit,0) as withdrawDeposit,
    IFNULL(t.frozen_amount,0) as frozenAmount,
    c.city_name as serviceCity,
    c.city_id as cityId,
    d.name createByName,
    e.name updateByName,
    f.supplier_full_name supplierName,
    i.group_id as groupId
    from car_biz_driver_info i
    LEFT JOIN car_biz_driver_account t on i.driver_id = t.driver_id
    LEFT JOIN car_biz_city c on c.city_id = i.service_city
    left join car_sys_user d on d.user_id=i.create_by
    left join car_sys_user e on e.user_id=i.update_by
    left join car_biz_supplier f on f.supplier_id=i.supplier_id
    left join car_biz_car_info ci on ci.license_plates=i.license_plates
    where i.driver_id = #{driverId}
  </select>

  <select id="queryOneDriver" parameterType="com.zhuanche.request.DutyParamRequest" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id AS driverId,
    i.phone AS phone,
    i.gender gender,
    i.NAME,
    i.license_plates AS licensePlates,
    i.supplier_id supplieId,
    i.STATUS AS status
    FROM
    car_biz_driver_info i
    <where>
    <if test="licensePlates!=null and licensePlates!=''">
      and i.license_plates LIKE '%${licensePlates}%'
    </if>
    <if test="driverId!=null and driverId!=''">
      and i.driver_id = #{driverId}
    </if>
    <if test="phone!=null and phone!=''">
      and i.phone = #{phone}
    </if>
      <if test="driverName!=null and driverName!=''">
        and i.NAME = #{driverName}
      </if>
    </where>
    limit 1
  </select>

  <select id="queryListDriverByDriverIds" parameterType="java.util.Map" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id AS driverId,
    i.phone AS phone,
    i.gender gender,
    i.NAME,
    i.license_plates AS licensePlates,
    i.supplier_id supplieId,
    i.STATUS AS status
    FROM
    car_biz_driver_info i
    where driver_id in
    <foreach collection="set" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>

  <select id="queryListByLimits" parameterType="com.zhuanche.request.DriverTeamRequest" resultType="com.zhuanche.dto.CarDriverInfoDTO">
    SELECT
    i.driver_id AS driverId
    FROM
    car_biz_driver_info i
    where 1=1
    <if test="licensePlates!=null and licensePlates!=''">
      and i.license_plates LIKE '%${licensePlates}%'
    </if>
    <if test="cityIds!=null and cityIds.size()>0">
      and i.service_city IN
      <foreach collection="cityIds" open="(" close=")" separator="," item="cid" >
        #{cid}
      </foreach>
    </if>
    <if test="supplierIds!=null and supplierIds.size()>0">
      and i.supplier_id IN
      <foreach collection="supplierIds" open="(" close=")" separator="," item="sid" >
        #{sid}
      </foreach>
    </if>

  </select>

  <select id="selectDriverList" resultType="com.zhuanche.dto.CarDriverInfoDTO"  parameterType="com.zhuanche.request.DriverTeamRequest">
    SELECT
    i.driver_id AS driverId,
    i.phone AS phone,
    i.gender gender,
    i.NAME,
    g.group_name AS carGroupName,
    c.city_name AS serviceCity,
    i.license_plates AS licensePlates,
    i.supplier_id supplieId,
    p.supplier_full_name AS supplierName,
    i.STATUS AS status,
    d.`name` createByName,
    e.`name` updateByName,
    i.id_card_no as idCardNo,
    i.age as age,
    i.superintend_no AS superintendNo,
    i.current_address as currentAddress,
    i.emergency_contact_number as emergencyContactNumber,
    i.emergency_contact_person as emergencyContactPerson,
    i.driving_license_type as drivingLicenseType,
    DATE_FORMAT(i.issue_date,'%Y-%m-%d %T')as issueDate,
    DATE_FORMAT(i.expire_date,'%Y-%m-%d %T')as expireDate,
    DATE_FORMAT(i.create_date,'%Y-%m-%d %H:%i:%s') createDateStr,
    DATE_FORMAT(i.update_date,'%Y-%m-%d %H:%i:%s') updateDateStr
    FROM
    car_biz_driver_info i
    LEFT JOIN car_biz_city c ON c.city_id = i.service_city
    LEFT JOIN car_biz_car_info a ON a.license_plates = i.license_plates
    LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
    LEFT JOIN car_biz_model m ON a.car_model_id = m.model_id
    LEFT JOIN car_biz_car_group g ON m.group_id = g.group_id
    left join car_sys_user d on d.user_id=i.create_by
    left join car_sys_user e on e.user_id=i.update_by
    where 1=1
    <if test="driverIds!=null and driverIds.size()>0">
      and i.driver_id IN
      <foreach collection="driverIds" open="(" close=")" separator="," item="did" >
        #{did}
      </foreach>
    </if>
    <if test="status!=null">
      and i.status= #{status}
    </if>
    <if test="licensePlates!=null and licensePlates!=''">
      and i.license_plates LIKE '%${licensePlates}%'
    </if>
    <if test="name!=null and name!=''">
      <!-- and i.name like '%name%' -->
      and i.name LIKE CONCAT(#{name},'%')
    </if>
    <if test="supplierId!=null and supplierId!=''">
      and i.supplier_Id = #{supplierId}
    </if>
    <if test="phone!=null and phone!=''">
      and i.phone LIKE '%${phone}%'
    </if>
    <if test="cityIds!=null and cityIds.size()>0">
      and i.service_city IN
      <foreach collection="cityIds" open="(" close=")" separator="," item="cid" >
        #{cid}
      </foreach>
    </if>
    <if test="supplierIds!=null and supplierIds.size()>0">
      and i.supplier_id IN
      <foreach collection="supplierIds" open="(" close=")" separator="," item="sid" >
        #{sid}
      </foreach>
    </if>
    order by i.update_date desc
  </select>

  <!-- mapper基础标准: 当前表所有字段查询条件集 -->
  <sql id="allBaseColumnWhereList" >
    <trim prefix="WHERE" prefixOverrides="AND|OR" suffixOverrides="AND|OR" >
      <if test="phone != null and phone != ''" >
        and phone LIKE '%${phone}%'
      </if>
      <if test="name != null and name != ''" >
        and name LIKE CONCAT(#{name},'%')
      </if>
      <if test="licensePlates != null and licensePlates != ''" >
        and license_plates LIKE   CONCAT('%',CONCAT(#{licensePlates},'%'))
      </if>
      <if test="status != null" >
        and status = #{status,jdbcType=INTEGER}
      </if>
      <if test="groupId != null and groupId != ''" >
        and group_id = #{groupId,jdbcType=INTEGER}
      </if>
      <if test="cooperationType != null and cooperationType != ''" >
        and cooperation_type = #{cooperationType,jdbcType=INTEGER}
      </if>
      <if test="imei != null and imei != ''" >
        and imei = #{imei,jdbcType=VARCHAR}
      </if>
      <if test="idCardNo != null and idCardNo != ''" >
        and id_card_no = #{idCardNo,jdbcType=VARCHAR}
      </if>
      <if test="isImage != null" >
        and is_image = #{isImage,jdbcType=INTEGER}
      </if>
      <if test="isTwoShifts != null" >
        and is_two_shifts = #{isTwoShifts,jdbcType=INTEGER}
      </if>
      <if test="serviceCity != null and serviceCity != ''" >
        and service_city = #{serviceCity,jdbcType=VARCHAR}
      </if>
      <if test="supplierId != null and supplierId != ''" >
        and supplier_id = #{supplierId,jdbcType=VARCHAR}
      </if>
      <if test="cityIds!=null and cityIds.size()>0">
        and service_city IN
        <foreach collection="cityIds" open="(" close=")" separator="," item="cid">
          #{cid}
        </foreach>
      </if>
      <if test="supplierIds!=null and supplierIds.size()>0">
        and supplier_id IN
        <foreach collection="supplierIds" open="(" close=")" separator="," item="sid">
          #{sid}
        </foreach>
      </if>
      <if test="driverIds!=null and driverIds.size()>0">
        and driver_id IN
        <foreach collection="driverIds" open="(" close=")" separator="," item="did">
          #{did}
        </foreach>
      </if>
    </trim>
  </sql>
  <select id="queryDriverList" resultMap="ResultMapWithBLOBs" >
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from car_biz_driver_info
    <include refid="allBaseColumnWhereList"/>
    order by update_date desc
  </select>
  <select id="checkPhone" resultType="java.lang.Integer" >
    select count(*)
    from car_biz_driver_info
    where phone= #{phone}
    <if test="driverId != null and driverId != ''">
      <![CDATA[ AND driver_id <>#{driverId}  ]]>
    </if>
  </select>
  <select id="checkIdCardNo" resultType="java.lang.Integer" >
    select count(*)
    from car_biz_driver_info
    where status=1 and id_card_no= #{idCardNo}
    <if test="driverId != null and driverId != ''">
      <![CDATA[ AND driver_id <>#{driverId}  ]]>
    </if>
  </select>
  <insert id="insertCarBizDriverInfoDTO" parameterType="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO" >
    <selectKey resultType="java.lang.Integer" keyProperty="driverId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into car_biz_driver_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="password != null" >
        password,
      </if>
      <if test="phone != null" >
        phone,
      </if>
      <if test="gender != null" >
        gender,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="supplierId != null" >
        supplier_id,
      </if>
      <if test="age != null" >
        age,
      </if>
      <if test="currentAddress != null" >
        current_address,
      </if>
      <if test="emergencyContactPerson != null" >
        emergency_contact_person,
      </if>
      <if test="emergencyContactNumber != null" >
        emergency_contact_number,
      </if>
      <if test="idCardNo != null" >
        id_card_no,
      </if>
      <if test="superintendNo != null" >
        superintend_no,
      </if>
      <if test="superintendUrl != null" >
        superintend_url,
      </if>
      <if test="drivingLicenseType != null" >
        driving_license_type,
      </if>
      <if test="drivingYears != null" >
        driving_years,
      </if>
      <if test="archivesNo != null" >
        archives_no,
      </if>
      <if test="issueDate != null" >
        issue_date,
      </if>
      <if test="expireDate != null" >
        expire_date,
      </if>
      <if test="serviceCity != null" >
        service_city,
      </if>
      <if test="attachmentName != null" >
        attachment_name,
      </if>
      <if test="attachmentAddr != null" >
        attachment_addr,
      </if>
      <if test="accountBank != null" >
        account_bank,
      </if>
      <if test="bankAccountNo != null" >
        bank_account_no,
      </if>
      <if test="licensePlates != null" >
        license_plates,
      </if>
      <if test="updateDate != null" >
        update_date,
      </if>
      <if test="createDate != null" >
        create_date,
      </if>
      <if test="updateBy != null" >
        update_by,
      </if>
      <if test="createBy != null" >
        create_by,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="mac != null" >
        mac,
      </if>
      <if test="photosrct != null" >
        photoSrct,
      </if>
      <if test="pushId != null" >
        push_id,
      </if>
      <if test="isBindingCreditCard != null" >
        is_binding_credit_card,
      </if>
      <if test="appVersion != null" >
        app_version,
      </if>
      <if test="creditCardNo != null" >
        credit_card_no,
      </if>
      <if test="storableCardNo != null" >
        storable_card_no,
      </if>
      <if test="creditOpenAccountBank != null" >
        credit_open_account_bank,
      </if>
      <if test="creditCardPeriodOfValidity != null" >
        credit_card_period_of_validity,
      </if>
      <if test="grabNotice != null" >
        grab_notice,
      </if>
      <if test="creditCvn2 != null" >
        credit_CVN2,
      </if>
      <if test="creditBindDate != null" >
        credit_bind_date,
      </if>
      <if test="quickpayCustomerid != null" >
        quickpay_customerid,
      </if>
      <if test="isRead != null" >
        is_read,
      </if>
      <if test="bankid != null" >
        bankid,
      </if>
      <if test="goHomeAddress != null" >
        go_home_address,
      </if>
      <if test="goHomePointLobd != null" >
        go_home_point_loBD,
      </if>
      <if test="goHomePointLabd != null" >
        go_home_point_laBD,
      </if>
      <if test="goHomePointLa != null" >
        go_home_point_la,
      </if>
      <if test="goHomePointLo != null" >
        go_home_point_lo,
      </if>
      <if test="goHomeStatus != null" >
        go_home_status,
      </if>
      <if test="updateGoHomeDate != null" >
        update_go_home_date,
      </if>
      <if test="imei != null" >
        imei,
      </if>
      <if test="driverlicensenumber != null" >
        driverLicenseNumber,
      </if>
      <if test="drivinglicenseimg != null" >
        drivingLicenseImg,
      </if>
      <if test="firstdrivinglicensedate != null" >
        firstDrivingLicenseDate,
      </if>
      <if test="firstmeshworkdrivinglicensedate != null" >
        firstMeshworkDrivingLicenseDate,
      </if>
      <if test="nationality != null" >
        nationality,
      </if>
      <if test="householdregister != null" >
        householdRegister,
      </if>
      <if test="nation != null" >
        nation,
      </if>
      <if test="marriage != null" >
        marriage,
      </if>
      <if test="foreignlanguage != null" >
        foreignLanguage,
      </if>
      <if test="currentAddress != null" >
        address,
      </if>
      <if test="education != null" >
        education,
      </if>
      <if test="coursename != null" >
        courseName,
      </if>
      <if test="coursedate != null" >
        courseDate,
      </if>
      <if test="coursedatestart != null" >
        courseDateStart,
      </if>
      <if test="coursedateend != null" >
        courseDateEnd,
      </if>
      <if test="coursetime != null" >
        courseTime,
      </if>
      <if test="corptype != null" >
        corpType,
      </if>
      <if test="trafficviolations != null" >
        trafficViolations,
      </if>
      <if test="signdate != null" >
        signDate,
      </if>
      <if test="signdateend != null" >
        signDateEnd,
      </if>
      <if test="contractdate != null" >
        contractDate,
      </if>
      <if test="isxydriver != null" >
        isXyDriver,
      </if>
      <if test="parttimejobdri != null" >
        partTimeJobDri,
      </if>
      <if test="phonetype != null" >
        phoneType,
      </if>
      <if test="phonecorp != null" >
        phoneCorp,
      </if>
      <if test="appversion != null" >
        appVersion,
      </if>
      <if test="maptype != null" >
        mapType,
      </if>
      <if test="emergencycontactaddr != null" >
        emergencyContactAddr,
      </if>
      <if test="assessment != null" >
        assessment,
      </if>
      <if test="driverlicenseissuingdatestart != null" >
        driverLicenseIssuingDateStart,
      </if>
      <if test="driverlicenseissuingdateend != null" >
        driverLicenseIssuingDateEnd,
      </if>
      <if test="driverlicenseissuingcorp != null" >
        driverLicenseIssuingCorp,
      </if>
      <if test="driverlicenseissuingnumber != null" >
        driverLicenseIssuingNumber,
      </if>
      <if test="xyDriverNumber != null" >
        xy_driver_number,
      </if>
      <if test="driverLicenseIssuingRegisterDate != null" >
        driver_license_issuing_register_date,
      </if>
      <if test="driverLicenseIssuingFirstDate != null" >
        driver_license_issuing_first_date,
      </if>
      <if test="driverLicenseIssuingGrantDate != null" >
        driver_license_issuing_grant_date,
      </if>
      <if test="birthDay != null" >
        birth_day,
      </if>
      <if test="houseHoldRegisterPermanent != null" >
        house_hold_register_permanent,
      </if>
      <if test="isUploadCard != null" >
        is_upload_card,
      </if>
      <if test="isMustConfirmation != null" >
        is_must_confirmation,
      </if>
      <if test="contractType != null" >
        contract_type,
      </if>
      <if test="contractNo != null" >
        contract_no,
      </if>
      <if test="contractFile != null" >
        contract_file,
      </if>
      <if test="cooperationType != null" >
        cooperation_type,
      </if>
      <if test="accountType != null" >
        account_type,
      </if>
      <if test="groupId != null" >
        group_id,
      </if>
      <if test="isTwoShifts != null" >
        is_two_shifts,
      </if>
      <if test="isImage != null" >
        is_image,
      </if>
      <if test="memo != null" >
        memo,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="password != null" >
        #{password,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        #{phone,jdbcType=VARCHAR},
      </if>
      <if test="gender != null" >
        #{gender,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="supplierId != null" >
        #{supplierId,jdbcType=INTEGER},
      </if>
      <if test="age != null" >
        #{age,jdbcType=INTEGER},
      </if>
      <if test="currentAddress != null" >
        #{currentAddress,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactPerson != null" >
        #{emergencyContactPerson,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactNumber != null" >
        #{emergencyContactNumber,jdbcType=VARCHAR},
      </if>
      <if test="idCardNo != null" >
        #{idCardNo,jdbcType=VARCHAR},
      </if>
      <if test="superintendNo != null" >
        #{superintendNo,jdbcType=VARCHAR},
      </if>
      <if test="superintendUrl != null" >
        #{superintendUrl,jdbcType=VARCHAR},
      </if>
      <if test="drivingLicenseType != null" >
        #{drivingLicenseType,jdbcType=VARCHAR},
      </if>
      <if test="drivingYears != null" >
        #{drivingYears,jdbcType=INTEGER},
      </if>
      <if test="archivesNo != null" >
        #{archivesNo,jdbcType=VARCHAR},
      </if>
      <if test="issueDate != null" >
        #{issueDate,jdbcType=TIMESTAMP},
      </if>
      <if test="expireDate != null" >
        #{expireDate,jdbcType=TIMESTAMP},
      </if>
      <if test="serviceCity != null" >
        #{serviceCity,jdbcType=INTEGER},
      </if>
      <if test="attachmentName != null" >
        #{attachmentName,jdbcType=VARCHAR},
      </if>
      <if test="attachmentAddr != null" >
        #{attachmentAddr,jdbcType=VARCHAR},
      </if>
      <if test="accountBank != null" >
        #{accountBank,jdbcType=VARCHAR},
      </if>
      <if test="bankAccountNo != null" >
        #{bankAccountNo,jdbcType=VARCHAR},
      </if>
      <if test="licensePlates != null" >
        #{licensePlates,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="createBy != null" >
        #{createBy,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="mac != null" >
        #{mac,jdbcType=VARCHAR},
      </if>
      <if test="photosrct != null" >
        #{photosrct,jdbcType=VARCHAR},
      </if>
      <if test="pushId != null" >
        #{pushId,jdbcType=VARCHAR},
      </if>
      <if test="isBindingCreditCard != null" >
        #{isBindingCreditCard,jdbcType=INTEGER},
      </if>
      <if test="appVersion != null" >
        #{appVersion,jdbcType=VARCHAR},
      </if>
      <if test="creditCardNo != null" >
        #{creditCardNo,jdbcType=VARCHAR},
      </if>
      <if test="storableCardNo != null" >
        #{storableCardNo,jdbcType=VARCHAR},
      </if>
      <if test="creditOpenAccountBank != null" >
        #{creditOpenAccountBank,jdbcType=VARCHAR},
      </if>
      <if test="creditCardPeriodOfValidity != null" >
        #{creditCardPeriodOfValidity,jdbcType=VARCHAR},
      </if>
      <if test="grabNotice != null" >
        #{grabNotice,jdbcType=INTEGER},
      </if>
      <if test="creditCvn2 != null" >
        #{creditCvn2,jdbcType=VARCHAR},
      </if>
      <if test="creditBindDate != null" >
        #{creditBindDate,jdbcType=TIMESTAMP},
      </if>
      <if test="quickpayCustomerid != null" >
        #{quickpayCustomerid,jdbcType=VARCHAR},
      </if>
      <if test="isRead != null" >
        #{isRead,jdbcType=INTEGER},
      </if>
      <if test="bankid != null" >
        #{bankid,jdbcType=VARCHAR},
      </if>
      <if test="goHomeAddress != null" >
        #{goHomeAddress,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLobd != null" >
        #{goHomePointLobd,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLabd != null" >
        #{goHomePointLabd,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLa != null" >
        #{goHomePointLa,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLo != null" >
        #{goHomePointLo,jdbcType=VARCHAR},
      </if>
      <if test="goHomeStatus != null" >
        #{goHomeStatus,jdbcType=INTEGER},
      </if>
      <if test="updateGoHomeDate != null" >
        #{updateGoHomeDate,jdbcType=VARCHAR},
      </if>
      <if test="imei != null" >
        #{imei,jdbcType=VARCHAR},
      </if>
      <if test="driverlicensenumber != null" >
        #{driverlicensenumber,jdbcType=VARCHAR},
      </if>
      <if test="drivinglicenseimg != null" >
        #{drivinglicenseimg,jdbcType=VARCHAR},
      </if>
      <if test="firstdrivinglicensedate != null" >
        #{firstdrivinglicensedate,jdbcType=VARCHAR},
      </if>
      <if test="firstmeshworkdrivinglicensedate != null" >
        #{firstmeshworkdrivinglicensedate,jdbcType=VARCHAR},
      </if>
      <if test="nationality != null" >
        #{nationality,jdbcType=VARCHAR},
      </if>
      <if test="householdregister != null" >
        #{householdregister,jdbcType=VARCHAR},
      </if>
      <if test="nation != null" >
        #{nation,jdbcType=VARCHAR},
      </if>
      <if test="marriage != null" >
        #{marriage,jdbcType=VARCHAR},
      </if>
      <if test="foreignlanguage != null" >
        #{foreignlanguage,jdbcType=VARCHAR},
      </if>
      <if test="currentAddress != null" >
        #{currentAddress,jdbcType=VARCHAR},
      </if>
      <if test="education != null" >
        #{education,jdbcType=VARCHAR},
      </if>
      <if test="coursename != null" >
        #{coursename,jdbcType=VARCHAR},
      </if>
      <if test="coursedate != null" >
        #{coursedate,jdbcType=VARCHAR},
      </if>
      <if test="coursedatestart != null" >
        #{coursedatestart,jdbcType=VARCHAR},
      </if>
      <if test="coursedateend != null" >
        #{coursedateend,jdbcType=VARCHAR},
      </if>
      <if test="coursetime != null" >
        #{coursetime,jdbcType=VARCHAR},
      </if>
      <if test="corptype != null" >
        #{corptype,jdbcType=VARCHAR},
      </if>
      <if test="trafficviolations != null" >
        #{trafficviolations,jdbcType=VARCHAR},
      </if>
      <if test="signdate != null" >
        #{signdate,jdbcType=VARCHAR},
      </if>
      <if test="signdateend != null" >
        #{signdateend,jdbcType=VARCHAR},
      </if>
      <if test="contractdate != null" >
        #{contractdate,jdbcType=VARCHAR},
      </if>
      <if test="isxydriver != null" >
        #{isxydriver,jdbcType=INTEGER},
      </if>
      <if test="parttimejobdri != null" >
        #{parttimejobdri,jdbcType=VARCHAR},
      </if>
      <if test="phonetype != null" >
        #{phonetype,jdbcType=VARCHAR},
      </if>
      <if test="phonecorp != null" >
        #{phonecorp,jdbcType=VARCHAR},
      </if>
      <if test="appversion != null" >
        #{appversion,jdbcType=VARCHAR},
      </if>
      <if test="maptype != null" >
        #{maptype,jdbcType=VARCHAR},
      </if>
      <if test="emergencycontactaddr != null" >
        #{emergencycontactaddr,jdbcType=VARCHAR},
      </if>
      <if test="assessment != null" >
        #{assessment,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingdatestart != null" >
        #{driverlicenseissuingdatestart,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingdateend != null" >
        #{driverlicenseissuingdateend,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingcorp != null" >
        #{driverlicenseissuingcorp,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingnumber != null" >
        #{driverlicenseissuingnumber,jdbcType=VARCHAR},
      </if>
      <if test="xyDriverNumber != null" >
        #{xyDriverNumber,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingRegisterDate != null" >
        #{driverLicenseIssuingRegisterDate,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingFirstDate != null" >
        #{driverLicenseIssuingFirstDate,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingGrantDate != null" >
        #{driverLicenseIssuingGrantDate,jdbcType=VARCHAR},
      </if>
      <if test="birthDay != null" >
        #{birthDay,jdbcType=VARCHAR},
      </if>
      <if test="houseHoldRegisterPermanent != null" >
        #{houseHoldRegisterPermanent,jdbcType=VARCHAR},
      </if>
      <if test="isUploadCard != null" >
        #{isUploadCard,jdbcType=INTEGER},
      </if>
      <if test="isMustConfirmation != null" >
        #{isMustConfirmation,jdbcType=INTEGER},
      </if>
      <if test="contractType != null" >
        #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractNo != null" >
        #{contractNo,jdbcType=VARCHAR},
      </if>
      <if test="contractFile != null" >
        #{contractFile,jdbcType=VARCHAR},
      </if>
      <if test="cooperationType != null" >
        #{cooperationType,jdbcType=TINYINT},
      </if>
      <if test="accountType != null" >
        #{accountType,jdbcType=INTEGER},
      </if>
      <if test="groupId != null" >
        #{groupId,jdbcType=INTEGER},
      </if>
      <if test="isTwoShifts != null" >
        #{isTwoShifts,jdbcType=INTEGER},
      </if>
      <if test="isImage != null" >
        #{isImage,jdbcType=TINYINT},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateCarBizDriverInfoDTO" parameterType="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO" >
    update car_biz_driver_info
    <set >
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="gender != null" >
        gender = #{gender,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="supplierId != null" >
        supplier_id = #{supplierId,jdbcType=INTEGER},
      </if>
      <if test="age != null" >
        age = #{age,jdbcType=INTEGER},
      </if>
      <if test="currentAddress != null" >
        current_address = #{currentAddress,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactPerson != null" >
        emergency_contact_person = #{emergencyContactPerson,jdbcType=VARCHAR},
      </if>
      <if test="emergencyContactNumber != null" >
        emergency_contact_number = #{emergencyContactNumber,jdbcType=VARCHAR},
      </if>
      <if test="idCardNo != null" >
        id_card_no = #{idCardNo,jdbcType=VARCHAR},
      </if>
      <if test="superintendNo != null" >
        superintend_no = #{superintendNo,jdbcType=VARCHAR},
      </if>
      <if test="superintendUrl != null" >
        superintend_url = #{superintendUrl,jdbcType=VARCHAR},
      </if>
      <if test="drivingLicenseType != null" >
        driving_license_type = #{drivingLicenseType,jdbcType=VARCHAR},
      </if>
      <if test="drivingYears != null" >
        driving_years = #{drivingYears,jdbcType=INTEGER},
      </if>
      <if test="archivesNo != null" >
        archives_no = #{archivesNo,jdbcType=VARCHAR},
      </if>
      <if test="issueDate != null" >
        issue_date = #{issueDate,jdbcType=TIMESTAMP},
      </if>
      <if test="expireDate != null" >
        expire_date = #{expireDate,jdbcType=TIMESTAMP},
      </if>
      <if test="serviceCity != null" >
        service_city = #{serviceCity,jdbcType=INTEGER},
      </if>
      <if test="attachmentName != null" >
        attachment_name = #{attachmentName,jdbcType=VARCHAR},
      </if>
      <if test="attachmentAddr != null" >
        attachment_addr = #{attachmentAddr,jdbcType=VARCHAR},
      </if>
      <if test="accountBank != null" >
        account_bank = #{accountBank,jdbcType=VARCHAR},
      </if>
      <if test="bankAccountNo != null" >
        bank_account_no = #{bankAccountNo,jdbcType=VARCHAR},
      </if>
      <if test="licensePlates != null" >
        license_plates = #{licensePlates,jdbcType=VARCHAR},
      </if>
      <if test="updateDate != null" >
        update_date = #{updateDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createDate != null" >
        create_date = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="updateBy != null" >
        update_by = #{updateBy,jdbcType=INTEGER},
      </if>
      <if test="createBy != null" >
        create_by = #{createBy,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="mac != null" >
        mac = #{mac,jdbcType=VARCHAR},
      </if>
      <if test="photosrct != null" >
        photoSrct = #{photosrct,jdbcType=VARCHAR},
      </if>
      <if test="pushId != null" >
        push_id = #{pushId,jdbcType=VARCHAR},
      </if>
      <if test="isBindingCreditCard != null" >
        is_binding_credit_card = #{isBindingCreditCard,jdbcType=INTEGER},
      </if>
      <if test="appVersion != null" >
        app_version = #{appVersion,jdbcType=VARCHAR},
      </if>
      <if test="creditCardNo != null" >
        credit_card_no = #{creditCardNo,jdbcType=VARCHAR},
      </if>
      <if test="storableCardNo != null" >
        storable_card_no = #{storableCardNo,jdbcType=VARCHAR},
      </if>
      <if test="creditOpenAccountBank != null" >
        credit_open_account_bank = #{creditOpenAccountBank,jdbcType=VARCHAR},
      </if>
      <if test="creditCardPeriodOfValidity != null" >
        credit_card_period_of_validity = #{creditCardPeriodOfValidity,jdbcType=VARCHAR},
      </if>
      <if test="grabNotice != null" >
        grab_notice = #{grabNotice,jdbcType=INTEGER},
      </if>
      <if test="creditCvn2 != null" >
        credit_CVN2 = #{creditCvn2,jdbcType=VARCHAR},
      </if>
      <if test="creditBindDate != null" >
        credit_bind_date = #{creditBindDate,jdbcType=TIMESTAMP},
      </if>
      <if test="quickpayCustomerid != null" >
        quickpay_customerid = #{quickpayCustomerid,jdbcType=VARCHAR},
      </if>
      <if test="isRead != null" >
        is_read = #{isRead,jdbcType=INTEGER},
      </if>
      <if test="bankid != null" >
        bankid = #{bankid,jdbcType=VARCHAR},
      </if>
      <if test="goHomeAddress != null" >
        go_home_address = #{goHomeAddress,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLobd != null" >
        go_home_point_loBD = #{goHomePointLobd,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLabd != null" >
        go_home_point_laBD = #{goHomePointLabd,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLa != null" >
        go_home_point_la = #{goHomePointLa,jdbcType=VARCHAR},
      </if>
      <if test="goHomePointLo != null" >
        go_home_point_lo = #{goHomePointLo,jdbcType=VARCHAR},
      </if>
      <if test="goHomeStatus != null" >
        go_home_status = #{goHomeStatus,jdbcType=INTEGER},
      </if>
      <if test="updateGoHomeDate != null" >
        update_go_home_date = #{updateGoHomeDate,jdbcType=VARCHAR},
      </if>
      <if test="imei != null" >
        imei = #{imei,jdbcType=VARCHAR},
      </if>
      <if test="driverlicensenumber != null" >
        driverLicenseNumber = #{driverlicensenumber,jdbcType=VARCHAR},
      </if>
      <if test="drivinglicenseimg != null" >
        drivingLicenseImg = #{drivinglicenseimg,jdbcType=VARCHAR},
      </if>
      <if test="firstdrivinglicensedate != null" >
        firstDrivingLicenseDate = #{firstdrivinglicensedate,jdbcType=VARCHAR},
      </if>
      <if test="firstmeshworkdrivinglicensedate != null" >
        firstMeshworkDrivingLicenseDate = #{firstmeshworkdrivinglicensedate,jdbcType=VARCHAR},
      </if>
      <if test="nationality != null" >
        nationality = #{nationality,jdbcType=VARCHAR},
      </if>
      <if test="householdregister != null" >
        householdRegister = #{householdregister,jdbcType=VARCHAR},
      </if>
      <if test="nation != null" >
        nation = #{nation,jdbcType=VARCHAR},
      </if>
      <if test="marriage != null" >
        marriage = #{marriage,jdbcType=VARCHAR},
      </if>
      <if test="foreignlanguage != null" >
        foreignLanguage = #{foreignlanguage,jdbcType=VARCHAR},
      </if>
      <if test="currentAddress != null" >
        address = #{currentAddress,jdbcType=VARCHAR},
      </if>
      <if test="education != null" >
        education = #{education,jdbcType=VARCHAR},
      </if>
      <if test="coursename != null" >
        courseName = #{coursename,jdbcType=VARCHAR},
      </if>
      <if test="coursedate != null" >
        courseDate = #{coursedate,jdbcType=VARCHAR},
      </if>
      <if test="coursedatestart != null" >
        courseDateStart = #{coursedatestart,jdbcType=VARCHAR},
      </if>
      <if test="coursedateend != null" >
        courseDateEnd = #{coursedateend,jdbcType=VARCHAR},
      </if>
      <if test="coursetime != null" >
        courseTime = #{coursetime,jdbcType=VARCHAR},
      </if>
      <if test="corptype != null" >
        corpType = #{corptype,jdbcType=VARCHAR},
      </if>
      <if test="trafficviolations != null" >
        trafficViolations = #{trafficviolations,jdbcType=VARCHAR},
      </if>
      <if test="signdate != null" >
        signDate = #{signdate,jdbcType=VARCHAR},
      </if>
      <if test="signdateend != null" >
        signDateEnd = #{signdateend,jdbcType=VARCHAR},
      </if>
      <if test="contractdate != null" >
        contractDate = #{contractdate,jdbcType=VARCHAR},
      </if>
      <if test="isxydriver != null" >
        isXyDriver = #{isxydriver,jdbcType=INTEGER},
      </if>
      <if test="parttimejobdri != null" >
        partTimeJobDri = #{parttimejobdri,jdbcType=VARCHAR},
      </if>
      <if test="phonetype != null" >
        phoneType = #{phonetype,jdbcType=VARCHAR},
      </if>
      <if test="phonecorp != null" >
        phoneCorp = #{phonecorp,jdbcType=VARCHAR},
      </if>
      <if test="appversion != null" >
        appVersion = #{appversion,jdbcType=VARCHAR},
      </if>
      <if test="maptype != null" >
        mapType = #{maptype,jdbcType=VARCHAR},
      </if>
      <if test="emergencycontactaddr != null" >
        emergencyContactAddr = #{emergencycontactaddr,jdbcType=VARCHAR},
      </if>
      <if test="assessment != null" >
        assessment = #{assessment,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingdatestart != null" >
        driverLicenseIssuingDateStart = #{driverlicenseissuingdatestart,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingdateend != null" >
        driverLicenseIssuingDateEnd = #{driverlicenseissuingdateend,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingcorp != null" >
        driverLicenseIssuingCorp = #{driverlicenseissuingcorp,jdbcType=VARCHAR},
      </if>
      <if test="driverlicenseissuingnumber != null" >
        driverLicenseIssuingNumber = #{driverlicenseissuingnumber,jdbcType=VARCHAR},
      </if>
      <if test="xyDriverNumber != null" >
        xy_driver_number = #{xyDriverNumber,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingRegisterDate != null" >
        driver_license_issuing_register_date = #{driverLicenseIssuingRegisterDate,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingFirstDate != null" >
        driver_license_issuing_first_date = #{driverLicenseIssuingFirstDate,jdbcType=VARCHAR},
      </if>
      <if test="driverLicenseIssuingGrantDate != null" >
        driver_license_issuing_grant_date = #{driverLicenseIssuingGrantDate,jdbcType=VARCHAR},
      </if>
      <if test="birthDay != null" >
        birth_day = #{birthDay,jdbcType=VARCHAR},
      </if>
      <if test="houseHoldRegisterPermanent != null" >
        house_hold_register_permanent = #{houseHoldRegisterPermanent,jdbcType=VARCHAR},
      </if>
      <if test="isUploadCard != null" >
        is_upload_card = #{isUploadCard,jdbcType=INTEGER},
      </if>
      <if test="isMustConfirmation != null" >
        is_must_confirmation = #{isMustConfirmation,jdbcType=INTEGER},
      </if>
      <if test="contractType != null" >
        contract_type = #{contractType,jdbcType=VARCHAR},
      </if>
      <if test="contractNo != null" >
        contract_no = #{contractNo,jdbcType=VARCHAR},
      </if>
      <if test="contractFile != null" >
        contract_file = #{contractFile,jdbcType=VARCHAR},
      </if>
      <if test="cooperationType != null" >
        cooperation_type = #{cooperationType,jdbcType=TINYINT},
      </if>
      <if test="accountType != null" >
        account_type = #{accountType,jdbcType=INTEGER},
      </if>
      <if test="groupId != null" >
        group_id = #{groupId,jdbcType=INTEGER},
      </if>
      <if test="isTwoShifts != null" >
        is_two_shifts = #{isTwoShifts,jdbcType=INTEGER},
      </if>
      <if test="isImage != null" >
        is_image = #{isImage,jdbcType=TINYINT},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where driver_id = #{driverId,jdbcType=INTEGER}
  </update>
  <update id="updateDriverByXiao" parameterType="java.lang.Integer">
		UPDATE car_biz_driver_info
		SET
          update_date = now(),
          status = 0,
          license_plates = NULL,
          phone = NULL
		WHERE driver_id = #{driverId}
  </update>
  <update id="resetIMEI" parameterType="java.lang.Integer">
		UPDATE car_biz_driver_info
		SET imei = null
		WHERE driver_id = #{driverId}
	</update>
  <select id="checkLicensePlates" resultType="java.lang.Integer" >
    select count(*)
    from car_biz_driver_info
    where license_plates= #{licensePlates}
  </select>

    <!-- 检测司机手机号是否存在 -->
    <select id="selectCountForPhone" resultType="java.lang.Integer" parameterType="com.zhuanche.entity.rentcar.CarBizDriverInfo">
      SELECT
		count(1)
		FROM
			car_biz_driver_info
        where phone= #{phone}

	</select>
    <!-- 验证银行卡卡号 -->
    <select id="validateBankCardNumber" parameterType="com.zhuanche.entity.mdbcarmanage.CarBizDriverInfoTemp"  resultType="int">
        select count(1) from car_biz_driver_info_detail
        where bank_card_number = #{bankCardNumber}
        <if test="driverId !=null and driverId !='' ">
            <![CDATA[ and driver_id <> #{driverId}  ]]>
        </if>
    </select>
    <!-- 根据身份证号检查司机是否存在 -->
    <select id="checkIdCardNoNew"  parameterType="com.zhuanche.entity.mdbcarmanage.CarBizDriverInfoTemp" resultType="java.lang.Integer">
        select
        count(*)
        from car_biz_driver_info
        where status!=0 and id_card_no=#{idCardNo}
        <if test="driverId !=null and driverId !='' ">
            <![CDATA[ and driver_id <> #{driverId}  ]]>
        </if>
    </select>
  <!-- 解绑司机信用卡，更新 -->
  <update id="updateDriverCardInfo" parameterType="java.util.Map">
    UPDATE car_biz_driver_info
    SET name=name, update_date = now()
    <if test="quickpayCustomerid!=null">
      ,quickpay_customerid = #{quickpayCustomerid}
    </if>
    <if test="creditOpenAccountBank!=null">
      ,credit_open_account_bank = #{creditOpenAccountBank}
    </if>
    <if test="shortCardNo!=null">
      ,storable_card_no = #{shortCardNo}
    </if>
    <if test="isBindingCreditCard!=null">
      ,is_binding_credit_card = #{isBindingCreditCard}
    </if>
    <if test="creditCardNo!=null">
      ,credit_card_no = #{creditCardNo}
    </if>
    <if test="CVN2!=null">
      ,credit_CVN2 = #{CVN2}
    </if>
    <if test="updateBy!=null and updateBy!=''">
      ,update_by = #{updateBy}
    </if>
    <if test="expireDate!=null">
      ,credit_card_period_of_validity = #{expireDate}
    </if>
    <if test="bindTime!=null">
      ,credit_bind_date = #{bindTime}
    </if>
    WHERE driver_id = #{driverId}
  </update>
  <update id="updateDriverCustomerId" parameterType="java.util.Map">
    UPDATE car_biz_driver_info
    SET uickpay_customerid = #{quickpayCustomerID}
    WHERE driver_id = #{driverID}
  </update>
  
  
  <select id="querySupplierIdAndNameByDriverId" parameterType="java.lang.Integer" resultType="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO">
		SELECT
		name ,
		phone,
		supplier_id AS supplierId
		FROM
		car_biz_driver_info
		where driver_id = #{driverId}
   </select>

  <select id="queryDriverByLicensePlates" parameterType="java.lang.String" resultMap="BaseResultMap">
    SELECT
      driver_id,phone,name,supplier_id,license_plates,service_city,id_card_no
    FROM
      car_biz_driver_info
    where license_plates = #{license_plates}
  </select>

  <select id="queryCarBizDriverList" resultMap="ResultMapWithBLOBs"  parameterType="com.zhuanche.dto.rentcar.CarBizDriverInfoDTO">
    select
    <include refid="Base_Column_List" />
    from car_biz_driver_info  i
    <where>
      <if test="driverIds!=null and driverIds.size()>0">
        and driver_id IN
        <foreach collection="driverIds" open="(" close=")" separator="," item="did">
          #{did}
        </foreach>
      </if>
      <if test="driverId != null and driverId != 0">
        and i.driver_id = #{driverId}
      </if>
      <if test="phone!=null and phone!=''">
        and i.phone = #{phone}
      </if>
      <if test="cityIds!=null and cityIds.size()>0">
        and i.service_city IN
        <foreach collection="cityIds" open="(" close=")" separator="," item="cid" >
          #{cid}
        </foreach>
      </if>
      <if test="serviceCity!=null and serviceCity != 0">
        and i.service_city  = #{serviceCity}
      </if>
      <if test="supplierIds!=null and supplierIds.size()>0">
        and i.supplier_id IN
        <foreach collection="supplierIds" open="(" close=")" separator="," item="sid" >
          #{sid}
        </foreach>
      </if>
      <if test="supplierId != null" >
        and  i.supplier_id = #{supplierId,jdbcType=INTEGER}
      </if>
      <if test="name!=null and name!=''">
        and i.name  = #{name}
      </if>
    </where>
    order by driver_id desc
  </select>
  
  <select id="selectDriverByKeyCountAddCooperation" resultType="java.lang.Integer"  parameterType="com.zhuanche.dto.driver.DriverVoEntity">
    SELECT
    count(*)
    FROM
    car_biz_driver_info i
    LEFT JOIN car_biz_city c ON c.city_id = i.service_city
    LEFT JOIN car_biz_car_info a ON a.license_plates = i.license_plates
    LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
    LEFT JOIN car_biz_model m ON a.car_model_id = m.model_id
    LEFT JOIN car_biz_car_group g ON i.group_id = g.group_id
    left join car_sys_user d on d.user_id=i.create_by
    left join car_sys_user e on e.user_id=i.update_by
    left join car_biz_cooperation_type t on t.id=i.cooperation_type
    <where>
      <if test="status!=null">
        and i.status= #{status}
      </if>
      <if test="licensePlates!=null and licensePlates!=''">
        and i.license_plates LIKE '%${licensePlates}%'
      </if>
      <if test="driverId!=null and driverId !=''">
        and i.driver_id = ${driverId}
      </if>
      <if test="driverIds!=null and driverIds !=''">
        and i.driver_id in(${driverIds})
      </if>
      <if test="name!=null and name!=''">
        <!-- and i.name like '%name%' -->
        and i.name LIKE CONCAT(#{name},'%')
      </if>
      <if test="supplierId!=null and supplierId!=''">
        and i.supplier_Id = #{supplierId}
      </if>
      <if test="phone!=null and phone!=''">
        and i.phone LIKE '%${phone}%'
      </if>
      <if test="serviceCityId!=null and serviceCityId!=''">
        and i.service_city = #{serviceCityId}
      </if>
      <if test="cities !=null and cities !=''">
        and i.service_city in (${cities})
      </if>
      <if test="suppliers !=null and suppliers !=''">
        and i.supplier_id in (${suppliers})
      </if>
      <if test="cooperationType !=null and cooperationType !=''">
        and t.id= #{cooperationType}
      </if>
      <if test="groupid !=null and groupid !=''">
        and i.group_id = #{groupid}
      </if>
      <if test="imei!=null and imei!=''">
        and i.imei LIKE '%${imei}%'
      </if>
      <if test="idCardNo!=null and idCardNo!=''">
        and i.id_card_no = #{idCardNo}
      </if>
      <if test="isImage!=null and isImage!=''">
        and i.is_image = #{isImage}
      </if>
    </where>
  </select>

  <select id="selectDriverByKeyAddCooperation"
          resultType="com.zhuanche.dto.driver.DriverVoEntity"
          parameterType="com.zhuanche.dto.driver.DriverVoEntity">
    SELECT
    i.driver_id AS driverId,
    i.service_city as serviceCityId,
    i.phone AS phone,
    i.gender gender,
    i.NAME,
    g.group_id AS groupid,
    g.group_name AS carGroupName,
    c.city_name AS serviceCity,
    i.license_plates AS licensePlates,
    i.supplier_id supplieId,
    p.supplier_full_name AS supplierName,
    i.STATUS AS status,
    d.`name` createByName,
    e.`name` updateByName,
    i.id_card_no as idCardNo,
    i.age as age,
    i.memo as memo,
    i.imei as imei,
    i.superintend_no AS superintendNo,
    i.superintend_url AS superintendUrl,
    i.current_address as currentAddress,
    i.emergency_contact_number as emergencyContactNumber,
    i.emergency_contact_person as emergencyContactPerson,
    i.driving_license_type as drivingLicenseType,
    DATE_FORMAT(i.issue_date,'%Y-%m-%d %T')as issueDate,
    i.driving_years as drivingYears,
    DATE_FORMAT(i.expire_date,'%Y-%m-%d %T')as expireDate,
    i.archives_no as archivesNo,
    DATE_FORMAT(i.create_date,'%Y-%m-%d %H:%i:%s') createDateStr,
    DATE_FORMAT(i.update_date,'%Y-%m-%d %H:%i:%s') updateDateStr,
    i.cooperation_type cooperationType,
    t.cooperation_name cooperationName,
    i.is_image isImage
    FROM
    car_biz_driver_info i
    LEFT JOIN car_biz_city c ON c.city_id = i.service_city
    LEFT JOIN car_biz_car_info a ON a.license_plates = i.license_plates
    LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
    LEFT JOIN car_biz_model m ON a.car_model_id = m.model_id
    LEFT JOIN car_biz_car_group g ON i.group_id = g.group_id
    left join car_sys_user d on d.user_id=i.create_by
    left join car_sys_user e on e.user_id=i.update_by
    left join car_biz_cooperation_type t on t.id=i.cooperation_type
    <where>
      <if test="status!=null">
        and i.status= #{status}
      </if>
      <if test="licensePlates!=null and licensePlates!=''">
        and i.license_plates LIKE '%${licensePlates}%'
      </if>
      <if test="driverId!=null and driverId !=''">
        and i.driver_id = ${driverId}
      </if>
      <if test="driverIds!=null and driverIds !=''">
        and i.driver_id in(${driverIds})
      </if>
      <if test="name!=null and name!=''">
        and i.name LIKE CONCAT(#{name},'%')
      </if>
      <if test="supplierId!=null and supplierId!=''">
        and i.supplier_Id = #{supplierId}
      </if>
      <if test="phone!=null and phone!=''">
        and i.phone LIKE '%${phone}%'
      </if>
      <if test="serviceCityId!=null and serviceCityId!=''">
        and i.service_city = #{serviceCityId}
      </if>
      <if test="cities !=null and cities !=''">
        and i.service_city in (${cities})
      </if>
      <if test="suppliers !=null and suppliers !=''">
        and i.supplier_id in (${suppliers})
      </if>
      <if test="cooperationType !=null and cooperationType !=''">
        and t.id= #{cooperationType}
      </if>
      <if test="groupid !=null and groupid !=''">
        and i.group_id = #{groupid}
      </if>
      <if test="imei!=null and imei!=''">
        and i.imei LIKE '%${imei}%'
      </if>
      <if test="idCardNo!=null and idCardNo!=''">
        and i.id_card_no = #{idCardNo}
      </if>
      <if test="isImage!=null and isImage!=''">
        and i.is_image = #{isImage}
      </if>
    </where>
    order by i.update_date desc
  </select>


  <select id="selectByPhone" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from car_biz_driver_info
    where phone = #{phone,jdbcType=INTEGER}
  </select>




	<!-- 根据供应商ID，修改司机的加盟类型 -->
	<update id="updateDriverCooperationTypeBySupplierId" parameterType="java.util.Map">
		UPDATE car_biz_driver_info
		set cooperation_type =
		#{cooperationType}
		WHERE supplier_id = #{supplierId}
	</update>
  

  <select id="selectByDriverId" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from car_biz_driver_info
    where driver_id = ${driverId,jdbcType=INTEGER}
  </select>

  <!-- 查询巴士订单指派/改派可用司机 -->
	<select id="queryBusDriverList" parameterType="com.zhuanche.dto.busManage.BusDriverRicherDTO" resultType="java.util.HashMap">
		SELECT 
			i.driver_id AS driverId ,
			i.name as name,
			i.phone as phone,
			p.supplier_full_name AS supplierName,
			g.group_name as groupName
		FROM 
			car_biz_driver_info i 
			LEFT JOIN car_biz_supplier p ON i.supplier_id = p.supplier_id
			LEFT JOIN car_biz_car_group g ON i.group_id = g.group_id
		where 
			g.type=2 AND i.status=1 AND i.driver_id != 0
		<if test="driverId != null">
			and i.driver_id = #{driverId}
		</if>
		<if test="invalidDriverIds != null and !invalidDriverIds.isEmpty()">
			and i.driver_id not in
			<foreach item="item" index="index" collection="invalidDriverIds" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		<if test="name != null and name != ''">
			and i.name LIKE CONCAT('%',#{name},'%')
		</if>
		<if test="phone != null and phone != ''">
			and i.phone LIKE CONCAT('%',#{phone},'%')
		</if>
		<if test="seatNum != null">
			and g.seat_num >= #{seatNum}
		</if>
		<if test="cityId != null">
			and i.service_city = #{cityId}
		</if>
		<if test="supplierId != null">
			and i.supplier_Id = #{supplierId}
		</if>
		<if test="supplierIds != null and !supplierIds.isEmpty()">
			and i.supplier_Id in 
			<foreach item="item" index="index" collection="supplierIds" open="(" separator="," close=")">
				#{item}
			</foreach>
		</if>
		order by i.update_date desc
	</select>
	
</mapper>